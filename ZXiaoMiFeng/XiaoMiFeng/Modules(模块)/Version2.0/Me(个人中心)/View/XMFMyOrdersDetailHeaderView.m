//
//  XMFMyOrdersDetailHeaderView.m
//  XiaoMiFeng
//
//  Created by üêùÂ∞èËúúËúÇüêù on 2020/9/10.
//  Copyright ¬© 2020 üêùÂ∞èËúúËúÇüêù. All rights reserved.
//

#import "XMFMyOrdersDetailHeaderView.h"
//#import "XMFMyOrdersDetailModel.h"//ËÆ¢ÂçïËØ¶ÊÉÖÊÄªmodel
#import "XMFMyOrdersListModel.h"//ÊàëÁöÑËÆ¢ÂçïÊÄªmodel
#import "XMFOrdersLogisticsModel.h"//Áâ©ÊµÅ‰ø°ÊÅØmodel


//Âú®.mÊñá‰ª∂‰∏≠Ê∑ªÂä†
@interface  XMFMyOrdersDetailHeaderView()

/** ËÆ¢ÂçïÁä∂ÊÄÅ */
@property (weak, nonatomic) IBOutlet UILabel *orderStatusLB;

/** ËÆ¢ÂçïÁä∂ÊÄÅÊèêÁ§∫ÁöÑÈ´òÂ∫¶ */
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *orderTipsLBHeight;



/** Êî∂‰ª∂‰∫∫‰ø°ÊÅØËÉåÊôØview */
@property (weak, nonatomic) IBOutlet UIView *consigneeInfoBgView;

/** Áâ©ÊµÅÁä∂ÊÄÅÁöÑËÉåÊôØview */
@property (weak, nonatomic) IBOutlet UIView *logisticsBgView;

/** Áâ©ÊµÅÁä∂ÊÄÅÁöÑËÉåÊôØviewÁöÑÈ´òÂ∫¶ */
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *logisticsBgViewHeight;


/** Áâ©ÊµÅÁä∂ÊÄÅ */
@property (weak, nonatomic) IBOutlet UILabel *logisticsStatusLB;

/** Êó∂Èó¥ */
@property (weak, nonatomic) IBOutlet UILabel *timeLB;


/** Êî∂‰ª∂‰∫∫ */
@property (weak, nonatomic) IBOutlet UILabel *consigneeLB;

/** Êî∂‰ª∂Âú∞ÂùÄ */
@property (weak, nonatomic) IBOutlet UILabel *addressLB;


/** ‰ªìÂ∫ì */

@property (weak, nonatomic) IBOutlet UIView *warehouseBgView;

@property (weak, nonatomic) IBOutlet NSLayoutConstraint *warehouseBgViewHeight;


@property (weak, nonatomic) IBOutlet UIButton *warehouseBtn;


@end

@implementation XMFMyOrdersDetailHeaderView

/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect {
    // Drawing code
}
*/


-(void)awakeFromNib{
    
    [super awakeFromNib];
    
    
    //Áâ©ÊµÅ‰ø°ÊÅØÊ∑ªÂä†ÊâãÂäø
    UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(tapAction:)];
    
    [self.logisticsBgView addGestureRecognizer:tap];
    
    
    
    
}



-(void)layoutSubviews{
    
    [super layoutSubviews];
    
    [self.consigneeInfoBgView cornerWithRadius:10.f];
    
}


-(void)setDetailModel:(XMFMyOrdersListModel *)detailModel{
    
    
    _detailModel = detailModel;
    
    
    OrderStatusInfo statusInfo = [GlobalManager getOrderStatusForKey:detailModel.orderStatus];

    if ([detailModel.orderStatus isEqualToString:@"104"]) {//ËÆ¢ÂçïÂ§ÑÁêÜ‰∏≠
        
        self.orderStatusLB.text = XMFLI(@"ËÆ¢ÂçïÂ§ÑÁêÜ‰∏≠ÔºåËØ∑Á®çÁ≠â");
        
    }else{
        
        self.orderStatusLB.text = statusInfo.statusName;
        
    }

    
    
    NSMutableAttributedString *consigneeInfoStr = [[XMFGlobalManager getGlobalManager] changToAttributedStringUpperStr:XMFLI(@"Êî∂‰ª∂‰∫∫Ôºö") upperColor:UIColorFromRGB(0x333333) upperFont:[UIFont systemFontOfSize:14.f] lowerStr:[NSString stringWithFormat:@"%@ %@",detailModel.consignee,detailModel.mobile] lowerColor:UIColorFromRGB(0x333333) lowerFont:[UIFont fontWithName:@"PingFangSC-Semibold" size:14.f]];
        
    self.consigneeLB.attributedText = consigneeInfoStr;
    
    self.addressLB.text = detailModel.address;
    
    
       /**
     ËÆ¢ÂçïÁä∂ÊÄÅÔºà101: 'Êú™‰ªòÊ¨æ‚Äô,102: 'Áî®Êà∑ÂèñÊ∂à‚Äô,103: 'Á≥ªÁªüÂèñÊ∂à‚Äô,109: '‰ªòÊ¨æÂ§±Ë¥•‚Äô,201: 'Â∑≤‰ªòÊ¨æ‚Äô, 202: 'Áî≥ËØ∑ÈÄÄÊ¨æ‚Äô, 203: 'Â∑≤ÈÄÄÊ¨æ‚Äô, 204: 'Â∑≤‰ªòÊ¨æÔºàÈÄÄÊ¨æÂ§±Ë¥•Ôºâ‚Äô, 209: 'ÈÄÄÊ¨æ‰∏≠‚Äô,301: 'Â∑≤ÂèëË¥ß‚Äô,401: 'Áî®Êà∑Êî∂Ë¥ß‚Äô, 402: ‚ÄòÁ≥ªÁªüÊî∂Ë¥ß‚Äô 409: 'ÂæÖËØÑ‰ª∑‚ÄôÔºâ
     */
    
    
    //ÊòØÂê¶ÂçáÁ∫ßËøáÂú∞ÂùÄ
    if (!detailModel.isUpdateAddress) {
        
        switch ([detailModel.orderStatus integerValue]) {
                
            case 101://Êú™‰ªòÊ¨æ
            case 104://ËÆ¢ÂçïÂ§ÑÁêÜ‰∏≠
                {
                    
                    
                    
                }
                break;
                
            case 201:{//Â∑≤‰ªòÊ¨æÔºåÂæÖÂèëË¥ß
                
               
                /** Êã£Ë¥ßÁä∂ÊÄÅ 1ÂæÖÊã£Ë¥ß 2Â∑≤Êã£Ë¥ß */
                
                NSString *tipsStr = @" ";
                
                switch ([detailModel.allocateCargoStatus integerValue]) {
                    case 1:{//
                        
                        tipsStr = XMFLI(@"‰π∞ÂÆ∂Â∑≤‰ªòÊ¨æÔºåÁ≠âÂæÖÂçñÂÆ∂ÂèëË¥ß");
                        
                    }
                        break;
                        
                    case 2:{//
                        
                        tipsStr = XMFLI(@"ÂçñÂÆ∂Â∑≤Êã£Ë¥ß");

                    }
                        break;
                        
                    default:
                        break;
                }
                
                
                if (detailModel.remark.length > 0) {
                    
                    //ÂΩìÊúâÁº∫Ë¥ßËØ¥ÊòéÁöÑÊó∂ÂÄôÂ∞±Ë¶Å‰∏âË°å
                    self.orderTipsLB.numberOfLines = 3;
                    
                    tipsStr = [NSString stringWithFormat:@"%@\nÂπ≥Âè∞ÊãíÁªùÈÄÄÊ¨æÂéüÂõ†Ôºö%@",tipsStr,detailModel.remark];
                    

                }
                
                
                if ([detailModel.outOfStock boolValue]) {
                    
                    tipsStr = XMFLI(@"ÊúâÂïÜÂìÅÁº∫Ë¥ß‰∫ÜÔºåÂÜçÁ≠âÁ≠âÂêß");
                }
                
                
                self.orderTipsLB.text = tipsStr;
            
                
//                self.orderTipsLB.text = XMFLI(@"‰π∞ÂÆ∂Â∑≤‰ªòÊ¨æÔºåÁ≠âÂæÖÂçñÂÆ∂ÂèëË¥ß");

                
                
            }
                break;
                
            case 301:{//Â∑≤ÂèëË¥ßÔºåÂæÖÊî∂Ë¥ß
                
                //ÂÖàÁ°ÆËÆ§Â∑≤Êî∂Ë¥ß
                if ([detailModel.receipt boolValue]) {
                    
                    
                    NSDateFormatter* formater = [[NSDateFormatter alloc] init];
                    [formater setDateFormat:@"yyyy-MM-dd"];
                    
                    //ÂΩìÂâçÊó∂Èó¥ÁöÑNSDate
                    NSDate* currentDate = [NSDate date];
                    
                    NSString *currentTimeString = [formater stringFromDate:currentDate];
                    
                    
                    NSInteger afterDay = [DateUtils compareBeginTime:currentTimeString endTime:detailModel.autoConfirmTime];
                    
                    
                    if (afterDay > 0) {
                        
                        self.orderTipsLB.text = [NSString stringWithFormat:@"Ââ©‰Ωô%zdÂ§©Ëá™Âä®Á°ÆËÆ§Êî∂Ë¥ß",afterDay];
                        
                    }else{
                        
                        self.orderTipsLB.hidden = YES;

                    }

                    
                    
                }else{
                    
                    self.orderTipsLB.hidden = YES;
                    
                    self.orderTipsLBHeight.constant = 0.f;
                    
                    //Êõ¥Êñ∞ViewÁöÑframeÂÄºÊâçÊúâÊïàÔºå‰ΩøÁî®layoutSubviewsÊó†Êïà
                    
                    CGRect tempFrame = self.frame;
                    
                    tempFrame.size.height -= 60;
                    
                    self.frame = tempFrame;
                    
                }
                
                
            }
                break;
                
            default:{
                
                self.orderTipsLB.hidden = YES;
                
                self.orderTipsLBHeight.constant = 0.f;
                
                //Êõ¥Êñ∞ViewÁöÑframeÂÄºÊâçÊúâÊïàÔºå‰ΩøÁî®layoutSubviewsÊó†Êïà
                
                CGRect tempFrame = self.frame;
                
                tempFrame.size.height -= 60;
                
                self.frame = tempFrame;
                
            }
                break;
        }
    }
    
    //ÈáçÁΩÆ‰∏Ä‰∏ãÔºåÈò≤Ê≠¢ÂÖ∂‰ªñÊõ¥Êîπ‰∫ÜÂ§¥ÈÉ®Êï∞ÊçÆ‰∏çËÉΩ
    detailModel.isUpdateAddress = NO;
    
    
    //‰ªìÂ∫ìÂêçÁß∞
    if (detailModel.warehouseName.length > 0) {
        
        [self.warehouseBtn setTitle:[NSString stringWithFormat:@"  %@",detailModel.warehouseName] forState:UIControlStateNormal];
        
        self.warehouseBgView.hidden = NO;
        
        
    }else{
        
        self.warehouseBgView.hidden = YES;
        
        self.warehouseBgViewHeight.constant = 0;
        
        //Êõ¥Êñ∞ViewÁöÑframeÂÄºÊâçÊúâÊïàÔºå‰ΩøÁî®layoutSubviewsÊó†Êïà
        
        CGRect tempFrame = self.frame;

        tempFrame.size.height -= 27;

        self.frame = tempFrame;

    }
    
    
    
}


-(void)setLogisticsModel:(XMFOrdersLogisticsModel *)logisticsModel{
    
    _logisticsModel = logisticsModel;
    
    
    if (logisticsModel.tracks.count > 0) {
        
        XMFOrdersLogisticsTracksModel *tracksModel = [logisticsModel.tracks firstObject];
        

        NSMutableAttributedString *consigneeInfoStr = [[XMFGlobalManager getGlobalManager] changToAttributedStringUpperStr:[NSString stringWithFormat:@"%@Ôºö",self.detailModel.shipChannel] upperColor:UIColorFromRGB(0x333333) upperFont:[UIFont systemFontOfSize:14.f] lowerStr:tracksModel.context lowerColor:UIColorFromRGB(0x333333) lowerFont:[UIFont fontWithName:@"PingFangSC-Semibold" size:14.f]];
            
        self.logisticsStatusLB.attributedText = consigneeInfoStr;
        
        NSArray *timeStrArr = [tracksModel.time componentsSeparatedByString:@" "];
        
        self.timeLB.text = [NSString stringWithFormat:@"%@ %@",timeStrArr[0],timeStrArr[1]];
        
        self.logisticsBgView.hidden = NO;
        
        self.logisticsBgViewHeight.constant = 84.f;
        
    }else{
        
        self.logisticsBgView.hidden = YES;
        
        self.logisticsBgViewHeight.constant = 0.f;
        
        //Êõ¥Êñ∞ViewÁöÑframeÂÄºÊâçÊúâÊïàÔºå‰ΩøÁî®layoutSubviewsÊó†Êïà
        
        CGRect tempFrame = self.frame;
        
        tempFrame.size.height -= 84;
        
        self.frame = tempFrame;
    }
    
    
}


//ÊâãÂäøÁªëÂÆöÊñπÊ≥ï
-(void)tapAction:(UIGestureRecognizer *)gesture{
    
    UIView *tapView = (UIView *)gesture.view;
    
    
    if ([self.delegate respondsToSelector:@selector(viewsOnXMFGoodsDetailHeaderViewDidTap:tapView:)]) {
        
        [self.delegate viewsOnXMFGoodsDetailHeaderViewDidTap:self tapView:tapView];
    }
    
}

@end
